{"ts":1363821628476,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"#!/usr/bin/perl\r\n\r\n# ------------------------------------------------------------------ #\r\n# xml2dumpinfo.pl by cutebutwrong ( http://www.mameworld.net/maws/ )\r\n#\r\n# Take a MAME listxml file and create an HTML list of sets that need\r\n# re-dumping, ordered by manufacturer.\r\n#\r\n# 2005/10/02 first release\r\n# 2005/10/10 filter out MCU undumpables\r\n#\r\n# ------------------------------------------------------------------ #\r\n\r\n# ------------------------------------------------------------------ #\r\n# includes\r\n\r\nuse XML::Parser;\r\n\r\n# ------------------------------------------------------------------ #\r\n# initialise\r\n\r\nmy $parser = XML::Parser->new(Style => 'Stream', Pkg => 'MameXmlSimple');\r\nmy $mame_xml = shift;\r\nmy %games = ();\r\nmy %mcus = ();\r\n\r\n# ------------------------------------------------------------------ #\r\n# main\r\n\r\n( (-e $mame_xml) && (-r $mame_xml) ) ||\r\n  die(\"Could not find XML file. Usage: perl xml2dumpinfo.pl \\\"mameinfo.xml\\\" > output.html\");\r\n\r\n$parser->parsefile($mame_xml);\r\n\r\nexit;\r\n\r\n# ------------------------------------------------------------------ #\r\n# subs\r\n\r\nsub escape_for_sql {\r\n my ( $self, $in_string, @p ) = @_;\r\n if ( $in_string ) {\r\n   $in_string =~ s/\\'/\\'\\'/ig;\r\n   return $in_string;\r\n } else {\r\n   return \"\";\r\n }\r\n}\r\n\r\n# ------------------------------------------------------------------ #\r\n# packages\r\n\r\npackage MameXmlSimple;\r\nuse Data::Dumper;\r\n\r\nmy (%game, $current_element, $game_count, $game_bad_count, $game_mcu_count,\r\n    @dump_roms, @dump_disks, @dump_mcus);\r\n$game_count = 0;\r\n\r\nsub StartTag {\r\n my ($self, $element) = @_;\r\n my %attributes = %_;\r\n \r\n if ($element eq 'game') {\r\n   %game = %attributes;\r\n   @dump_roms = ();\r\n   @dump_disks = ();\r\n   @dump_mcus = ();\r\n   $game_count++;\r\n\r\n } elsif ($element eq 'rom') {\r\n   # get attributes\r\n   if ( ($attributes{\"name\"} eq \"pr1data.8k\") && ($attributes{\"status\"} ne \"good\") ) {\r\n    # skip Namco substitute ROM\r\n    $dump_mcus[@dump_mcus] = \\%attributes;\r\n   # } elsif ( ($attributes{\"name\"} =~ m/.*\\.mcu/ig) && ($attributes{\"status\"} ne \"good\") ) {  \r\n   #  # skip .mcu ROMs\r\n   #  $dump_mcus[@dump_mcus] = \\%attributes;\r\n   } elsif ( $attributes{\"status\"} && ($attributes{\"status\"} ne \"good\") ) {\r\n    $dump_roms[@dump_roms] = \\%attributes;\r\n   }\r\n\r\n } elsif ($element eq 'disk') {\r\n   # get attributes\r\n   if ( $attributes{\"status\"} && ($attributes{\"status\"} ne \"good\") ) {\r\n    $dump_disks[@dump_disks] = \\%attributes;\r\n   }\r\n\r\n }\r\n \r\n $current_element = $element;\r\n \r\n if ( $game_count > 50 ) {\r\n  # exit;\r\n }\r\n}\r\n\r\nsub Characters {\r\n my ($self, $element) = @_;\r\n if (($current_element eq 'description')\r\n     || ($current_element eq 'year')\r\n     || ($current_element eq 'manufacturer')) {\r\n   my $text = $self->{Text};\r\n   # clear white space\r\n   $text =~ s/^\\s*//;\r\n   $text =~ s/\\s*$//;\r\n   $game{$current_element} = $text if $text;\r\n }\r\n}\r\n\r\nsub EndTag {\r\n my ($self, $element) = @_;\r\n if ($element eq \"game\") {\r\n  my %cgame = %game;\r\n  if ( @dump_roms || @dump_disks ) {\r\n   my @cdump_roms = @dump_roms;\r\n   my @cdump_disks = @dump_disks;\r\n   $games{ $game{\"manufacturer\"} }{ $game{\"description\"} }{ \"game\" } = \\%cgame;\r\n   $games{ $game{\"manufacturer\"} }{ $game{\"description\"} }{ \"roms\" } = \\@cdump_roms;\r\n   $games{ $game{\"manufacturer\"} }{ $game{\"description\"} }{ \"disks\" } = \\@cdump_disks;\r\n   $game_bad_count++;\r\n  }\r\n  if ( @dump_mcus ) {\r\n   my @cdump_mcus = @dump_mcus;\r\n   $mcus{ $game{\"manufacturer\"} }{ $game{\"description\"} }{ \"game\" } = \\%cgame;\r\n   $mcus{ $game{\"manufacturer\"} }{ $game{\"description\"} }{ \"mcus\" } = \\@cdump_mcus;\r\n   $game_mcu_count++;\r\n  }\r\n }\r\n}\r\n\r\nsub StartDocument {\r\n my ($self) = @_;\r\n print \"<html>\\n<head>\\n\";\r\n print '<style type=\"text/css\"> * { font-family: Arial, Helvetica, sans-serif; } BODY { font-size: 80%; } .manulist { margin: 0px; padding: 0px; } LI.manu { font-weight: bold; list-style-type: none; margin: 0px; padding: 0px; } LI.set { font-weight: normal; list-style-type: none; margin: 0px; padding: 0px; } LI.rom_nodump, LI.rom_baddump { list-style-type: square; } LI.disk_nodump, LI.disk_baddump { list-style-type: disc; } </style>'.\"\\n\";\r\n print \"</head>\\n<body>\\n\";\r\n}\r\n\r\nsub EndDocument {\r\n my ($self) = @_;\r\n print \"<h1>ROMs that need re-dumping as of MAME&trade; version .xxx.xx</h1>\\n\";\r\n print \"<p>\".$game_count.\" total sets of which \".$game_bad_count.\" need re-dumping<br>\\n\";\r\n print \"Games listed with &quot;baddump&quot; have known parts that are bad or suspected to be bad. <br>\\n\";\r\n print \"Games listed  with &quot;nodump&quot; are known or suspected to be missing some data.</p>\\n\";\r\n print \"<p>NOTE!<br>\\n\";\r\n print \"Hopefully some new flags will be introduced to give more details about things such as MCUs that can not be dumped.<br>\\n\";\r\n print \"So for now, ignore anything about MCU's being needed because there are many that were read and were protected. The likelyhood of all of them being protected is very high, the effort is better spent elsewhere.<br>\\n\";\r\n print \"Also ignore all of the bad dumps of 'pr1data.8k' in the NAMCO section being wanted. Hopefully a new flag can be introduced there also to state that 'pr1data.8k' is simply a substitute ROM being used until the real data can be extracted (if possible).</p>\\n\";\r\n \r\n print \"<h2>ROM Missing and Bad Dumps</h2>\\n\";\r\n print \"<ul class=\\\"manulist\\\">\\n\";\r\n foreach $manufacturer (sort keys %games) {\r\n  print \"<li class=\\\"manu\\\">\".&escapeHtml( $manufacturer ).\"\\n\";\r\n  print \" <ol>\\n\";\r\n  my $games_ref = $games{$manufacturer};\r\n  my %manu_games = %$games_ref;\r\n  foreach $game_name (sort keys %manu_games ) {\r\n    my $game_ref = ($manu_games{$game_name}{\"game\"}); my %mgame = %$game_ref; \r\n    my $roms_ref = $manu_games{$game_name}{\"roms\"}; my @dump_roms = @$roms_ref;\r\n    my $disks_ref = $manu_games{$game_name}{\"disks\"}; my @dump_disks = @$disks_ref;\r\n    print \"  <li class=\\\"set\\\">\".&escapeHtml( $mgame{\"description\"} ).\" (<a href=\\\"http://www.mameworld.net/maws/set/\".$mgame{\"name\"}.\"\\\">\".$mgame{\"name\"}.\"</a>)\\n\";\r\n    if ( @dump_roms ) {\r\n     print \"   <ul>\\n\";\r\n     for($dLoop=0;$dLoop<@dump_roms;$dLoop++) {\r\n      print \"    <li class=\\\"rom_\".$dump_roms[$dLoop]{\"status\"}.\"\\\">\".$dump_roms[$dLoop]{\"name\"}.\" - \".$dump_roms[$dLoop]{\"status\"}.\"</li>\\n\";\r\n     }\r\n     print \"   </ul>\\n\";\r\n    }\r\n    if ( @dump_disks ) {\r\n     print \"   <ul>\\n\";\r\n     for($dLoop=0;$dLoop<@dump_disks;$dLoop++) {\r\n      print \"    <li class=\\\"disk_\".$dump_disks[$dLoop]{\"status\"}.\"\\\">\".$dump_disks[$dLoop]{\"name\"}.\".chd - \".$dump_disks[$dLoop]{\"status\"}.\"</li>\\n\";\r\n     }\r\n     print \"   </ul>\\n\";\r\n    }\r\n    print \"  </li>\\n\";\r\n  }\r\n  print \" </ol>\\n\";\r\n  print \"</li>\\n\";\r\n }\r\n print \"</ul>\\n\";\r\n\r\n print \"<h2>Dumps Not Required (undumpable MCUs, etc?)</h2>\\n\";\r\n print \"<ul class=\\\"manulist\\\">\\n\";\r\n foreach $manufacturer (sort keys %mcus) {\r\n  print \"<li class=\\\"manu\\\">\".&escapeHtml( $manufacturer ).\"\\n\";\r\n  print \" <ol>\\n\";\r\n  my $mcu_ref = $mcus{$manufacturer};\r\n  my %manu_games = %$mcu_ref;\r\n  foreach $game_name (sort keys %manu_games ) {\r\n    my $game_ref = ($manu_games{$game_name}{\"game\"}); my %mgame = %$game_ref; \r\n    my $mcu_ref = $manu_games{$game_name}{\"mcus\"}; my @dump_mcus = @$mcu_ref;\r\n    print \"  <li class=\\\"set\\\">\".&escapeHtml( $mgame{\"description\"} ).\" (<a href=\\\"http://www.mameworld.net/maws/set/\".$mgame{\"name\"}.\"\\\">\".$mgame{\"name\"}.\"</a>)\\n\";\r\n    if ( @dump_mcus ) {\r\n     print \"   <ul>\\n\";\r\n     for($dLoop=0;$dLoop<@dump_mcus;$dLoop++) {\r\n      print \"    <li class=\\\"mcu_\".$dump_mcus[$dLoop]{\"status\"}.\"\\\">\".$dump_mcus[$dLoop]{\"name\"}.\" - \".$dump_mcus[$dLoop]{\"status\"}.\"</li>\\n\";\r\n     }\r\n     print \"   </ul>\\n\";\r\n    }\r\n    print \"  </li>\\n\";\r\n  }\r\n  print \" </ol>\\n\";\r\n  print \"</li>\\n\";\r\n }\r\n print \"</ul>\\n\";\r\n\r\n print \"</body></html>\\n\";\r\n}\r\n\r\nsub Text {\r\n my ($self, $element) = @_;\r\n if ( ($current_element eq 'description')\r\n      || ($current_element eq 'year')\r\n      || ($current_element eq 'manufacturer')) {\r\n   my $text = $self->{Text};\r\n   # print $current_element.\" \".$text.\"\\n\";\r\n   # clear white space\r\n   $text =~ s/^\\s*//;\r\n   $text =~ s/\\s*$//;\r\n   $game{$current_element} = $text if $text;\r\n }\r\n}\r\n\r\nsub escapeHtml {\r\n my ($html, @p) = @_;\r\n $html  =~ s/</&lt;/;\r\n $html  =~ s/>/&gt;/;\r\n $html  =~ s/\"/&quot;/;\r\n return $html;\r\n}\r\n\r\n1;\r\n\r\n\r\n__END__\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":8267}]],"length":8267}
